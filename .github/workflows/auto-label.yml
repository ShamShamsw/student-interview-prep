name: "Auto-label new issues"

"on":
  issues:
    types: [opened, edited]

jobs:
  label-issue:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Label issue based on title/body
        uses: actions/github-script@v8
        with:
          script: |
            // Auto-label script: helper-based, easy to extend.
            const issue = context.payload.issue;
            if (!issue) return;

            const title = (issue.title || '').toLowerCase();
            const body = (issue.body || '').toLowerCase();

            const labels = new Set();

            function addIf(cond, label) {
              if (cond) labels.add(label);
            }

            // Simple keyword-based labeling rules
            addIf(
              title.includes('bug') ||
              body.includes('bug') ||
              /error|exception|fail|crash/.test(title),
              'bug'
            );

            addIf(
              title.includes('feature') ||
              body.includes('feature') ||
              title.includes('enhancement') ||
              body.includes('enhancement'),
              'feature'
            );

            addIf(
              body.includes('problem') ||
              title.includes('problem') ||
              body.includes('exercise') ||
              body.includes('solution'),
              'problem-suggestion'
            );

            addIf(body.includes('help wanted') || title.includes('help wanted'), 'help wanted');

            addIf(
              body.includes('first time') ||
              body.includes('good first issue') ||
              title.includes('good first issue'),
              'good first issue'
            );

            if (labels.size === 0) labels.add('triage');

            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: Array.from(labels)
            });
